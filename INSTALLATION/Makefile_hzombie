#******************************###########*
#
# Makefile for Zombie with HDF5 extension
#
# Prepared by BH Park, ORNL
#
#******************************###########*

MPICXX=$(HOME)/RHPC_2.0/ext/MPICH/bin/mpicxx
BOOST_INCLUDE=-I$(HOME)/RHPC_2.0/ext/Boost/Boost_1.54/include/
BOOST_LIB_DIR=-L$(HOME)/RHPC_2.0/ext/Boost/Boost_1.54/lib/
BOOST_LIBS=-lboost_mpi-mt-s -lboost_serialization-mt-s -lboost_system-mt-s -lboost_filesystem-mt-s

INCLUDE=-I$(HOME)/RHPC_2.0/include
LIB_DIR=-L$(HOME)/RHPC_2.0/lib

REPAST_HPC_LIB=-lrepast_hpc-2.0
RELOGO_LIB=-lrelogo-2.0

HDF5_INCLUDE=-I$(HOME)/hdf5/include
HDF5_LIB_DIR=$(HOME)/hdf5/lib
HDF5_LIBS=$(HDF5_LIB_DIR)/libhdf5_hl.a $(HDF5_LIB_DIR)/libhdf5.a -lz

NETCDF_INCLUDE_DIR=$(HOME)/RHPC_2.0/ext/NetCDF/include
NETCDF_LIB_DIR=$(HOME)/RHPC_2.0/ext/NetCDF/lib
CURL_INCLUDE_DIR=$(HOME)/RHPC_2.0/ext/CURL/include
CURL_LIB_DIR=$(HOME)/RHPC_2.0/ext/CURL/lib

# DERIVED VARIABLES (Do not modify)
I_REPAST=-I$(REPAST_HPC_DIR)
I_BOOST=-I$(BOOST_INCLUDE_DIR)
L_BOOST=-L$(BOOST_LIB_DIR)
l_BOOST=-lboost_mpi$(BOOST_INFIX) -lboost_serialization$(BOOST_INFIX) -lboost_system$(BOOST_INFIX) -lboost_filesystem$(BOOST_INFIX)
I_NETCDF=-I$(NETCDF_INCLUDE_DIR)
L_NETCDF=-L$(NETCDF_LIB_DIR)
l_NETCDF=-lnetcdf -lnetcdf_c++
I_CURL=-I$(CURL_INCLUDE_DIR)
L_CURL=-L$(CURL_LIB_DIR)
l_CURL=-lcurl

#To enable openMP support, uncomment the following
#OMPFLAG=-fopenmp -D__OMP__

#SOURCES=$(wildcard ./*.cpp)
SOURCES= main.cpp Zombie.cpp Human.cpp ZombieObserver.cpp InfectionSum.cpp
OBJECTS=$(SOURCES:.cpp=.o)
BACKUPS=$(wildcard ./*~)
EXECUTABLE=./zombie

all: $(SOURCES) $(EXECUTABLE)
	
$(EXECUTABLE): $(OBJECTS)
	$(MPICXX) $^ $(HDF5_LIBS) $(LIB_DIR) $(BOOST_LIB_DIR) $(L_NETCDF) $(l_NETCDF) $(RELOGO_LIB) $(REPAST_HPC_LIB) $(BOOST_LIBS) -o $@

.cpp.o: 
	$(MPICXX) $(OMPFLAG) $(INCLUDE) $(I_CURL) $(HDF5_INCLUDE) $(I_NETCDF) $(RELOGO_INCLUDE) $(BOOST_INCLUDE) $(REPAST_HPC_INCLUDE) -c $< -o $@

clean:
	rm -rf $(OBJECTS)
	rm -rf $(EXECUTABLE)
	rm -rf $(BACKUPS)
